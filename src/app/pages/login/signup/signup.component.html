<div class="signup-container">
  <div class="animated-bg"></div>

  <mat-card class="signup-card">
    <div class="card-header">
      <button 
        type="button"
        mat-icon-button
        routerLink="/login"
        class="back-button"
        [disabled]="loading()"
        aria-label="Voltar para login">
        <mat-icon>arrow_back</mat-icon>
      </button>
      
      @if (true) {
        <div class="logo-container">
          <img src="assets/quiz.png" alt="QuizLab Logo" class="logo">
        </div>
      }
      <p class="subtitle">Criar Conta</p>
    </div>

    <form [formGroup]="form" (ngSubmit)="signup()" class="signup-form">
      <!-- Name Field -->
      <mat-form-field appearance="outline" class="full-width" subscriptSizing="dynamic">
        <mat-label>
          <mat-icon class="input-icon">person</mat-icon>
          Nome Completo
        </mat-label>
        <input 
          matInput 
          type="text"
          formControlName="name"
          autocomplete="name"
          required>
        @if (name?.hasError('required') && name?.touched) {
          <mat-error>Nome é obrigatório</mat-error>
        }
        @if (name?.hasError('minlength') && name?.touched) {
          <mat-error>Nome deve ter no mínimo 3 caracteres</mat-error>
        }
      </mat-form-field>

      <!-- Email Field -->
      <mat-form-field appearance="outline" class="full-width" subscriptSizing="dynamic">
        <mat-label>
          <mat-icon class="input-icon">email</mat-icon>
          Email
        </mat-label>
        <input 
          matInput 
          type="email"
          formControlName="email"
          autocomplete="email"
          required>
        @if (email?.hasError('required') && email?.touched) {
          <mat-error>Email é obrigatório</mat-error>
        }
        @if (email?.hasError('email') && email?.touched) {
          <mat-error>Email inválido</mat-error>
        }
      </mat-form-field>

      <!-- Password Field -->
      <mat-form-field appearance="outline" class="full-width" subscriptSizing="dynamic">
        <mat-label>
          <mat-icon class="input-icon">lock</mat-icon>
          Senha
        </mat-label>
        <input 
          matInput 
          [type]="hidePassword() ? 'password' : 'text'"
          formControlName="password"
          autocomplete="new-password"
          required>
        <button 
          type="button"
          mat-icon-button 
          matSuffix 
          (click)="togglePasswordVisibility()"
          class="password-toggle"
          [attr.aria-label]="hidePassword() ? 'Mostrar senha' : 'Ocultar senha'">
          <mat-icon>{{ hidePassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        @if (password?.hasError('required') && password?.touched) {
          <mat-error>Senha é obrigatória</mat-error>
        }
        @if (password?.hasError('minlength') && password?.touched) {
          <mat-error>Senha deve ter no mínimo 6 caracteres</mat-error>
        }
      </mat-form-field>

      <!-- Confirm Password Field -->
      <mat-form-field appearance="outline" class="full-width" subscriptSizing="dynamic">
        <mat-label>
          <mat-icon class="input-icon">lock_clock</mat-icon>
          Confirmar Senha
        </mat-label>
        <input 
          matInput 
          [type]="hideConfirmPassword() ? 'password' : 'text'"
          formControlName="confirmPassword"
          autocomplete="new-password"
          required>
        <button 
          type="button"
          mat-icon-button 
          matSuffix 
          (click)="toggleConfirmPasswordVisibility()"
          class="password-toggle"
          [attr.aria-label]="hideConfirmPassword() ? 'Mostrar senha' : 'Ocultar senha'">
          <mat-icon>{{ hideConfirmPassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        @if (confirmPassword?.hasError('required') && confirmPassword?.touched) {
          <mat-error>Confirmação de senha é obrigatória</mat-error>
        }
        @if (confirmPassword?.hasError('minlength') && confirmPassword?.touched) {
          <mat-error>Senha deve ter no mínimo 6 caracteres</mat-error>
        }
        @if (form.hasError('passwordMismatch') && confirmPassword?.touched) {
          <mat-error>As senhas não coincidem</mat-error>
        }
      </mat-form-field>

      <!-- Role Select -->
      <mat-form-field appearance="outline" class="full-width" subscriptSizing="dynamic">
        <mat-label>
          <mat-icon class="input-icon">badge</mat-icon>
          Tipo de Usuário
        </mat-label>
        <mat-select formControlName="role" required>
          @for (roleOption of roles; track roleOption.value) {
            <mat-option [value]="roleOption.value">
              {{ roleOption.label }}
            </mat-option>
          }
        </mat-select>
        @if (role?.hasError('required') && role?.touched) {
          <mat-error>Tipo de usuário é obrigatório</mat-error>
        }
      </mat-form-field>

      <!-- Signup Button -->
      <button 
        type="submit"
        mat-raised-button 
        color="primary" 
        class="signup-button full-width"
        [disabled]="form.invalid || loading()">
        @if (loading()) {
          <mat-spinner diameter="20" class="button-spinner"></mat-spinner>
          <span>Criando Conta...</span>
        } @else {
          <div style="display: flex;">
            <mat-icon>person_add</mat-icon>
            <span>Criar Conta</span>
          </div>
        }
      </button>

      <!-- Divider -->
      <mat-divider class="divider-with-text">
        <span>Já tem uma conta?</span>
      </mat-divider>

      <!-- Login Link -->
      <button 
        type="button"
        mat-stroked-button 
        class="full-width login-link-button"
        routerLink="/login"
        [disabled]="loading()">
        <mat-icon>login</mat-icon>
        Entrar
      </button>
    </form>
  </mat-card>
</div>
